import{r as p,u as C,j as e,L as _,E as F,c as b,M as q,S as P,f as B,a as T,b as $}from"./index-DnX4Cz3C.js";const V={ì ê·¹ë§¤ìˆ˜:2,ë§¤ìˆ˜:1,ì¤‘ë¦½:0,ë§¤ë„:-1,ì ê·¹ë§¤ë„:-2};function Q(i,s){return!i&&!s?"mismatch":i?s?i===s?"match":Math.abs(V[i]-V[s])<=1?"partial":"mismatch":"vision-only":"api-only"}function W(i){switch(i){case"match":return 1;case"partial":return .7;case"vision-only":case"api-only":return .5;case"mismatch":return .3;default:return 0}}function G({status:i}){const s={match:{label:"ì™„ì „ ì¼ì¹˜",shortLabel:"ì¼ì¹˜",className:"bg-emerald-100 text-emerald-700 border-emerald-200",icon:"âœ“"},partial:{label:"ìœ ì‚¬",shortLabel:"ìœ ì‚¬",className:"bg-blue-100 text-blue-700 border-blue-200",icon:"â‰ˆ"},mismatch:{label:"ë¶ˆì¼ì¹˜",shortLabel:"ë¶ˆì¼ì¹˜",className:"bg-red-100 text-red-700 border-red-200",icon:"âœ—"},"vision-only":{label:"Visionë§Œ",shortLabel:"V",className:"bg-purple-100 text-purple-700 border-purple-200",icon:"ğŸ‘"},"api-only":{label:"APIë§Œ",shortLabel:"A",className:"bg-cyan-100 text-cyan-700 border-cyan-200",icon:"ğŸ“¡"}},{label:l,shortLabel:x,className:d,icon:g}=s[i];return e.jsxs("span",{className:b("inline-flex items-center gap-0.5 md:gap-1 px-1.5 md:px-2 py-0.5 rounded text-[0.65rem] md:text-xs font-medium border",d),children:[e.jsx("span",{children:g}),e.jsx("span",{className:"hidden md:inline",children:l}),e.jsx("span",{className:"md:hidden",children:x})]})}function K({score:i}){const s=Math.round(i*100),l=i>=.8?"bg-emerald-500":i>=.5?"bg-amber-500":"bg-red-500";return e.jsxs("div",{className:"flex items-center gap-1.5 md:gap-2",children:[e.jsx("div",{className:"flex-1 h-1 md:h-1.5 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:b("h-full rounded-full transition-all",l),style:{width:`${s}%`}})}),e.jsxs("span",{className:"text-[0.65rem] md:text-xs font-medium text-text-muted w-7 md:w-8",children:[s,"%"]})]})}const Y=p.memo(function({stock:s}){var v,y,N,m;const[l,x]=p.useState(!1),d=((y=(v=s.apiData)==null?void 0:v.price)==null?void 0:y.change_rate_pct)??0,g=d>0?"text-red-500":d<0?"text-blue-500":"text-text-secondary";return e.jsxs("div",{className:b("bg-bg-secondary border rounded-xl p-3 md:p-4",s.matchStatus==="match"?"border-emerald-300 bg-emerald-50/30":s.matchStatus==="mismatch"?"border-red-300 bg-red-50/30":"border-border"),children:[e.jsxs("div",{className:"flex justify-between items-start mb-2 md:mb-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-1.5 md:gap-2 mb-1 flex-wrap",children:[e.jsx("a",{href:`https://m.stock.naver.com/domestic/stock/${s.code}/total`,target:"_blank",rel:"noopener noreferrer",className:"font-bold text-base md:text-lg text-text-primary hover:text-accent-primary transition-colors truncate",children:s.name}),e.jsx("span",{className:`text-[0.65rem] md:text-xs px-1 md:px-1.5 py-0.5 rounded flex-shrink-0 ${s.market==="KOSPI"?"bg-blue-100 text-blue-700":"bg-purple-100 text-purple-700"}`,children:s.market})]}),((m=(N=s.apiData)==null?void 0:N.price)==null?void 0:m.current)!=null&&e.jsxs("div",{className:"flex items-baseline gap-1.5 md:gap-2",children:[e.jsxs("span",{className:"text-base md:text-lg font-bold",children:[s.apiData.price.current.toLocaleString(),"ì›"]}),e.jsxs("span",{className:b("text-xs md:text-sm font-medium",g),children:[(s.apiData.price.change_rate_pct??0)>0?"+":"",(s.apiData.price.change_rate_pct??0).toFixed(2),"%"]})]})]}),e.jsx(G,{status:s.matchStatus})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 md:gap-3 mb-2 md:mb-3",children:[e.jsxs("div",{className:"bg-bg-primary rounded-lg p-2 md:p-3",children:[e.jsxs("div",{className:"text-[0.65rem] md:text-xs text-text-muted mb-1 md:mb-1.5 flex items-center gap-1",children:[e.jsx("span",{children:"ğŸ‘"})," ",e.jsx("span",{className:"hidden md:inline",children:"Vision AI"}),e.jsx("span",{className:"md:hidden",children:"Vision"})]}),s.visionSignal?e.jsx(P,{signal:s.visionSignal}):e.jsx("span",{className:"text-[0.65rem] md:text-xs text-text-muted",children:"ì—†ìŒ"})]}),e.jsxs("div",{className:"bg-bg-primary rounded-lg p-2 md:p-3",children:[e.jsxs("div",{className:"text-[0.65rem] md:text-xs text-text-muted mb-1 md:mb-1.5 flex items-center gap-1",children:[e.jsx("span",{children:"ğŸ“¡"})," ",e.jsx("span",{className:"hidden md:inline",children:"í•œíˆ¬ API"}),e.jsx("span",{className:"md:hidden",children:"API"})]}),s.apiSignal?e.jsx(P,{signal:s.apiSignal}):e.jsx("span",{className:"text-[0.65rem] md:text-xs text-text-muted",children:"ì—†ìŒ"})]})]}),e.jsxs("div",{className:"mb-2 md:mb-3",children:[e.jsx("div",{className:"text-[0.65rem] md:text-xs text-text-muted mb-1",children:"ì‹ ë¢°ë„"}),e.jsx(K,{score:s.confidenceScore})]}),(s.visionReason||s.apiReason)&&e.jsxs("div",{className:"cursor-pointer",onClick:()=>x(!l),children:[e.jsxs("div",{className:"flex items-center justify-between text-[0.65rem] md:text-xs text-text-muted mb-1",children:[e.jsx("span",{children:"ë¶„ì„ ê·¼ê±°"}),e.jsx("span",{className:"transition-transform duration-200",style:{transform:l?"rotate(180deg)":"rotate(0deg)"},children:"â–¼"})]}),e.jsx("div",{className:b("overflow-hidden transition-all duration-300 ease-in-out",l?"max-h-[500px] opacity-100":"max-h-0 opacity-0"),children:e.jsxs("div",{className:"space-y-1.5 md:space-y-2",children:[s.visionReason&&e.jsxs("div",{className:"bg-purple-50 border border-purple-100 rounded-lg p-2 md:p-3",children:[e.jsx("div",{className:"text-[0.65rem] md:text-xs font-medium text-purple-700 mb-1",children:"ğŸ‘ Vision"}),e.jsx("p",{className:"text-xs md:text-sm text-text-secondary",children:s.visionReason})]}),s.apiReason&&e.jsxs("div",{className:"bg-cyan-50 border border-cyan-100 rounded-lg p-2 md:p-3",children:[e.jsx("div",{className:"text-[0.65rem] md:text-xs font-medium text-cyan-700 mb-1",children:"ğŸ“¡ API"}),e.jsx("p",{className:"text-xs md:text-sm text-text-secondary",children:s.apiReason})]})]})})]})]})});function S({icon:i,label:s,value:l,subValue:x,colorClass:d}){return e.jsxs("div",{className:"bg-bg-secondary border border-border rounded-xl px-2 py-2 md:px-4 md:py-3 flex items-center gap-2 md:gap-3 shadow-sm",children:[e.jsx("div",{className:b("w-8 h-8 md:w-10 md:h-10 rounded-lg flex items-center justify-center text-base md:text-xl flex-shrink-0",d||"bg-gray-100"),children:i}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-[0.55rem] md:text-[0.65rem] text-text-muted uppercase tracking-wide font-semibold truncate",children:s}),e.jsxs("div",{className:"text-sm md:text-base font-bold text-text-primary",children:[l,x&&e.jsxs("span",{className:"text-[0.65rem] md:text-sm text-text-muted font-medium ml-0.5 md:ml-1",children:["(",x,")"]})]})]})]})}function H({children:i}){return e.jsxs("div",{className:"text-[0.8125rem] text-text-secondary flex items-start gap-3 px-4 py-3 bg-slate-50 border border-slate-200 rounded-lg leading-relaxed mb-4",children:[e.jsx("svg",{className:"w-4 h-4 flex-shrink-0 text-slate-500 mt-0.5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M15 15l-2 5L9 9l11 4-5 2zm0 0l5 5M7.188 2.239l.777 2.897M5.136 7.965l-2.898-.777M13.95 4.05l-2.122 2.122m-5.657 5.656l-2.12 2.122"})}),e.jsx("span",{className:"flex-1",children:i})]})}const J=["ì ê·¹ë§¤ìˆ˜","ë§¤ìˆ˜","ì¤‘ë¦½","ë§¤ë„","ì ê·¹ë§¤ë„"];function Z(){const[i,s]=p.useState("all"),[l,x]=p.useState(new Set),[d,g]=p.useState(new Set),v=t=>{x(a=>{const n=new Set(a);return n.has(t)?n.delete(t):n.add(t),n})},y=t=>{g(a=>{const n=new Set(a);return n.has(t)?n.delete(t):n.add(t),n})},N=()=>{x(new Set),g(new Set)},{data:m,isLoading:z}=C({queryKey:["vision","latest"],queryFn:B}),{data:h,isLoading:O}=C({queryKey:["kis-data"],queryFn:T}),{data:f,isLoading:R}=C({queryKey:["kis-analysis"],queryFn:$}),u=p.useMemo(()=>{const t=new Map;if(m!=null&&m.results&&m.results.forEach(a=>{const n=a.code.startsWith("3")||a.code.startsWith("4")?"KOSDAQ":"KOSPI";t.set(a.code,{code:a.code,name:a.name,market:n,visionSignal:a.signal,visionReason:a.reason,matchStatus:"vision-only",confidenceScore:.5})}),h!=null&&h.stocks){const a=new Map;f!=null&&f.results&&f.results.forEach(n=>a.set(n.code,n)),Object.values(h.stocks).forEach(n=>{const r=a.get(n.code),o=t.get(n.code);o?(o.apiData=n,o.apiSignal=r==null?void 0:r.signal,o.apiReason=r==null?void 0:r.reason,o.matchStatus=Q(o.visionSignal,o.apiSignal),o.confidenceScore=W(o.matchStatus)):t.set(n.code,{code:n.code,name:n.name,market:n.market,apiData:n,apiSignal:r==null?void 0:r.signal,apiReason:r==null?void 0:r.reason,matchStatus:(r!=null&&r.signal,"api-only"),confidenceScore:r!=null&&r.signal?.5:0})})}return Array.from(t.values())},[m,h,f]),j=p.useMemo(()=>{let t=u;return i!=="all"&&(t=t.filter(a=>a.market.toLowerCase()===i)),l.size>0&&(t=t.filter(a=>l.has(a.matchStatus))),d.size>0&&(t=t.filter(a=>{const n=a.visionSignal&&d.has(a.visionSignal),r=a.apiSignal&&d.has(a.apiSignal);return n||r})),t.sort((a,n)=>n.confidenceScore-a.confidenceScore)},[u,i,l,d]),c=p.useMemo(()=>{let t=0,a=0,n=0,r=0,o=0,L=0;for(const M of u){switch(M.matchStatus){case"match":t++;break;case"partial":a++;break;case"mismatch":n++;break;case"vision-only":r++;break;case"api-only":o++;break}L+=M.confidenceScore}const w=u.length,k=w>0?L/w:0;return{total:w,matched:t,partial:a,mismatched:n,visionOnly:r,apiOnly:o,avgConfidence:k}},[u]),{marketCounts:E,signalCounts:D}=p.useMemo(()=>{let t=0,a=0;const n={ì ê·¹ë§¤ìˆ˜:0,ë§¤ìˆ˜:0,ì¤‘ë¦½:0,ë§¤ë„:0,ì ê·¹ë§¤ë„:0};for(const r of u)r.market==="KOSPI"?t++:r.market==="KOSDAQ"&&a++,r.visionSignal&&n[r.visionSignal]++,r.apiSignal&&r.apiSignal!==r.visionSignal&&n[r.apiSignal]++;return{marketCounts:{all:j.length,kospi:t,kosdaq:a},signalCounts:n}},[u,j]);if(z||O||R)return e.jsx("section",{id:"combined-analysis",className:"mb-10",children:e.jsx(_,{message:"ë°ì´í„° í†µí•© ì¤‘..."})});const A=m&&m.results&&m.results.length>0,I=(h==null?void 0:h.stocks)&&Object.keys(h.stocks).length>0;return!A&&!I?e.jsx("section",{id:"combined-analysis",className:"mb-10",children:e.jsx(F,{icon:"ğŸ“Š",title:"ë¶„ì„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤",description:"Vision AI ë¶„ì„ ë˜ëŠ” í•œíˆ¬ API ë°ì´í„°ê°€ ìˆ˜ì§‘ë˜ë©´ ì—¬ê¸°ì— ë¹„êµ ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤."})}):e.jsxs("section",{id:"combined-analysis",className:"mb-10",children:[e.jsx("div",{className:"flex justify-between items-center mb-5 flex-wrap gap-3",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-xl font-bold text-text-primary mb-1",children:"ë¶„ì„ ì¢…í•©"}),e.jsx("p",{className:"text-sm text-text-muted",children:"Vision AIì™€ í•œíˆ¬ API ë¶„ì„ ê²°ê³¼ ë¹„êµ ê²€ì¦"})]})}),A&&!I&&e.jsxs("div",{className:"flex items-center gap-2 px-4 py-3 bg-amber-50 border border-amber-200 rounded-lg mb-5 text-sm text-amber-800",children:[e.jsx("span",{children:"ğŸ“¡"}),e.jsx("span",{children:"í•œíˆ¬ API ë°ì´í„°ê°€ ì•„ì§ ìˆ˜ì§‘ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. í˜„ì¬ëŠ” Vision AI ë¶„ì„ ê²°ê³¼ë§Œ í‘œì‹œë©ë‹ˆë‹¤."})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 mb-5",children:[e.jsx(S,{icon:"ğŸ“Š",label:"ì´ ì¢…ëª©",value:c.total,colorClass:"bg-gray-100"}),e.jsx(S,{icon:"âœ“",label:"ì™„ì „ ì¼ì¹˜",value:c.matched,subValue:`${(c.matched/c.total*100).toFixed(0)}%`,colorClass:"bg-emerald-100"}),e.jsx(S,{icon:"â‰ˆ",label:"ìœ ì‚¬",value:c.partial,colorClass:"bg-blue-100"}),e.jsx(S,{icon:"âœ—",label:"ë¶ˆì¼ì¹˜",value:c.mismatched,colorClass:"bg-red-100"})]}),e.jsxs("div",{className:"bg-bg-secondary border border-border rounded-xl p-4 mb-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"í‰ê·  ì‹ ë¢°ë„"}),e.jsxs("span",{className:"text-lg font-bold",children:[(c.avgConfidence*100).toFixed(0),"%"]})]}),e.jsx(K,{score:c.avgConfidence}),e.jsx("p",{className:"text-xs text-text-muted mt-2",children:"ë‘ ë¶„ì„ ì†ŒìŠ¤ì˜ ì¼ì¹˜ìœ¨ì´ ë†’ì„ìˆ˜ë¡ ì‹ ë¢°ë„ê°€ ë†’ìŠµë‹ˆë‹¤. ì™„ì „ ì¼ì¹˜=100%, ìœ ì‚¬=70%, ë‹¨ì¼ ì†ŒìŠ¤=50%, ë¶ˆì¼ì¹˜=30%"})]}),e.jsx(H,{children:'"ì™„ì „ ì¼ì¹˜" ì¢…ëª©ì€ Vision AIì™€ API ë¶„ì„ ì‹œê·¸ë„ì´ ë™ì¼í•©ë‹ˆë‹¤. "ë¶ˆì¼ì¹˜" ì¢…ëª©ì€ ì¶”ê°€ ê²€í† ê°€ í•„ìš”í•©ë‹ˆë‹¤.'}),e.jsxs("div",{className:"bg-bg-secondary border border-border rounded-xl p-4 mb-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-sm font-semibold text-text-primary",children:"í•„í„°"}),(l.size>0||d.size>0)&&e.jsx("button",{onClick:N,className:"text-xs text-accent-primary hover:underline",children:"í•„í„° ì´ˆê¸°í™”"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"text-xs text-text-muted mb-2",children:"ì¼ì¹˜ ìƒíƒœ (ë³µìˆ˜ ì„ íƒ ê°€ëŠ¥)"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:[{value:"match",label:"ì™„ì „ ì¼ì¹˜",icon:"âœ“",count:c.matched},{value:"partial",label:"ìœ ì‚¬",icon:"â‰ˆ",count:c.partial},{value:"mismatch",label:"ë¶ˆì¼ì¹˜",icon:"âœ—",count:c.mismatched},{value:"vision-only",label:"Visionë§Œ",icon:"ğŸ‘",count:c.visionOnly},{value:"api-only",label:"APIë§Œ",icon:"ğŸ“¡",count:c.apiOnly}].map(({value:t,label:a,icon:n,count:r})=>e.jsxs("button",{onClick:()=>v(t),className:b("px-2.5 py-1.5 rounded-lg text-xs font-medium transition-all border",l.has(t)?"bg-accent-primary text-white border-accent-primary":"bg-bg-primary text-text-secondary border-border hover:border-accent-primary"),children:[e.jsx("span",{className:"mr-1",children:n}),a," (",r,")"]},t))})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-text-muted mb-2",children:"ì‹œê·¸ë„ (ë³µìˆ˜ ì„ íƒ ê°€ëŠ¥)"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:J.map(t=>{const a={ì ê·¹ë§¤ìˆ˜:"bg-signal-strong-buy text-white border-signal-strong-buy",ë§¤ìˆ˜:"bg-signal-buy text-white border-signal-buy",ì¤‘ë¦½:"bg-signal-neutral text-white border-signal-neutral",ë§¤ë„:"bg-signal-sell text-white border-signal-sell",ì ê·¹ë§¤ë„:"bg-signal-strong-sell text-white border-signal-strong-sell"};return e.jsxs("button",{onClick:()=>y(t),className:b("px-2.5 py-1.5 rounded-lg text-xs font-medium transition-all border",d.has(t)?a[t]:"bg-bg-primary text-text-secondary border-border hover:border-accent-primary"),children:[t," (",D[t],")"]},t)})})]}),(l.size>0||d.size>0)&&e.jsx("div",{className:"mt-3 pt-3 border-t border-border-light",children:e.jsxs("div",{className:"text-xs text-text-muted",children:["ì„ íƒëœ í•„í„°: "," ",l.size===0&&d.size===0?"ì „ì²´":e.jsxs(e.Fragment,{children:[Array.from(l).map(t=>({match:"ì™„ì „ ì¼ì¹˜",partial:"ìœ ì‚¬",mismatch:"ë¶ˆì¼ì¹˜","vision-only":"Visionë§Œ","api-only":"APIë§Œ"})[t]).join(", "),l.size>0&&d.size>0&&" + ",Array.from(d).join(", ")]})," ","â†’ ",j.length,"ê±´"]})})]}),e.jsx(q,{active:i,counts:E,onChange:s}),j.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:j.map(t=>e.jsx(Y,{stock:t},t.code))}):e.jsx(F,{icon:"ğŸ”",title:"ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤",description:"ì„ íƒí•œ í•„í„° ì¡°ê±´ì— ë§ëŠ” ì¢…ëª©ì´ ì—†ìŠµë‹ˆë‹¤."})]})}export{Z as CombinedAnalysis};
